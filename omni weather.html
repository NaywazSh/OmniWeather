<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global OmniWeather | Analyze. Travel. Gear Up.</title>
    
    <!-- External Libraries (Map, Icons, Charts) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #00d2ff;
            --secondary: #3a7bd5;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --accent: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        
        body { background-color: var(--dark-bg); color: var(--text-main); min-height: 100vh; }

        /* --- Header & Nav --- */
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1.5rem 5%; background: rgba(15, 23, 42, 0.95);
            border-bottom: 1px solid #334155; position: sticky; top: 0; z-index: 1000;
        }
        .logo { font-size: 1.5rem; font-weight: 800; background: linear-gradient(to right, var(--primary), var(--accent)); -webkit-background-clip: text; color: transparent; }
        
        .search-bar {
            display: flex; background: var(--card-bg); border-radius: 50px; padding: 0.5rem 1.5rem; border: 1px solid #334155;
        }
        .search-bar input { background: transparent; border: none; color: white; outline: none; width: 250px; }
        .search-bar button { background: transparent; border: none; color: var(--primary); cursor: pointer; }

        /* --- Main Layout --- */
        .container { display: grid; grid-template-columns: 1fr 350px; gap: 2rem; padding: 2rem 5%; max-width: 1600px; margin: 0 auto; }
        
        @media (max-width: 1000px) { .container { grid-template-columns: 1fr; } }

        /* --- Left Column: Map & Analytics --- */
        .main-content { display: flex; flex-direction: column; gap: 2rem; }

        .hero-card {
            background: linear-gradient(135deg, var(--card-bg), #26354f);
            padding: 2rem; border-radius: 20px; display: flex; justify-content: space-between; align-items: center;
        }
        .temp-display h1 { font-size: 4rem; font-weight: 300; }
        .temp-display p { font-size: 1.2rem; color: var(--text-muted); }
        
        .map-container {
            height: 400px; width: 100%; border-radius: 20px; overflow: hidden; border: 2px solid #334155; z-index: 1;
        }

        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .stat-card {
            background: var(--card-bg); padding: 1.5rem; border-radius: 15px; text-align: center;
            border: 1px solid #334155; transition: transform 0.2s;
        }
        .stat-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .stat-card i { font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--primary); }

        /* --- Right Column: Commercial & Actions --- */
        .sidebar { display: flex; flex-direction: column; gap: 2rem; }

        .widget { background: var(--card-bg); padding: 1.5rem; border-radius: 20px; border: 1px solid #334155; }
        .widget h3 { border-bottom: 1px solid #334155; padding-bottom: 0.5rem; margin-bottom: 1rem; color: var(--accent); }

        .recommendation-card {
            background: rgba(255, 255, 255, 0.05); padding: 1rem; border-radius: 10px; margin-bottom: 1rem;
            display: flex; align-items: center; gap: 1rem; cursor: pointer; transition: 0.3s;
        }
        .recommendation-card:hover { background: rgba(255, 255, 255, 0.1); }
        .rec-icon { width: 40px; height: 40px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: black; font-weight: bold; }
        
        .btn-buy {
            display: block; width: 100%; padding: 0.8rem; background: var(--primary); border: none; border-radius: 8px;
            color: #000; font-weight: bold; cursor: pointer; text-align: center; margin-top: 1rem; text-decoration: none;
        }
        .btn-buy:hover { background: #33e0ff; }

        /* --- Footer --- */
        footer { text-align: center; padding: 2rem; color: var(--text-muted); font-size: 0.9rem; margin-top: 2rem; border-top: 1px solid #334155; }
    </style>
</head>
<body>

    <!-- Navigation -->
    <nav>
        <div class="logo"><i class="fa-solid fa-earth-americas"></i> OmniWeather</div>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search city (e.g., London, Tokyo)...">
            <button onclick="fetchWeather()"><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>
        <div class="date-time" id="currentDate">loading...</div>
    </nav>

    <div class="container">
        <!-- Main Analysis Section -->
        <div class="main-content">
            
            <!-- Hero Weather Info -->
            <div class="hero-card" id="weatherHero">
                <div class="temp-display">
                    <h2 id="cityName">New York, US</h2>
                    <p id="weatherDesc">Clear Sky</p>
                    <h1 id="temperature">24째C</h1>
                    <p>Updated: <span id="updateTime">Just now</span></p>
                </div>
                <div class="weather-icon">
                    <i class="fa-solid fa-sun fa-5x" style="color: var(--accent);"></i>
                </div>
            </div>

            <!-- Global Map -->
            <div class="map-container" id="weatherMap"></div>

            <!-- Detailed Analytics -->
            <h3 style="margin-bottom: 10px;">Deep Weather Analysis</h3>
            <div class="analytics-grid">
                <div class="stat-card">
                    <i class="fa-solid fa-wind"></i>
                    <h4>Wind</h4>
                    <p id="windSpeed">12 km/h</p>
                    <small id="windDir">NW</small>
                </div>
                <div class="stat-card">
                    <i class="fa-solid fa-droplet"></i>
                    <h4>Humidity</h4>
                    <p id="humidity">45%</p>
                </div>
                <div class="stat-card">
                    <i class="fa-solid fa-gauge"></i>
                    <h4>Pressure</h4>
                    <p id="pressure">1012 hPa</p>
                </div>
                <div class="stat-card">
                    <i class="fa-solid fa-eye"></i>
                    <h4>Visibility</h4>
                    <p id="visibility">10 km</p>
                </div>
            </div>

            <!-- Chart Section (Compact Version) -->
<div class="widget" style="padding: 1rem; min-height: auto;">
    <h3 style="font-size: 1.1rem; margin-bottom: 5px; border-bottom: none;">
        <i class="fa-solid fa-chart-line"></i> Temperature Trend
    </h3>
    <!-- Constrain the height here -->
    <div style="height: 130px; width: 100%; position: relative;">
        <canvas id="tempChart"></canvas>
    </div>
</div>

        <!-- Sidebar: Commerce & Travel -->
        <div class="sidebar">
            
            <!-- Smart Gear Shop -->
            <div class="widget">
                <h3><i class="fa-solid fa-shirt"></i> Recommended Gear</h3>
                <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem;">AI-driven suggestions based on current conditions.</p>
                
                <div id="merchContainer">
                    <!-- Dynamic Content Inserted via JS -->
                    <div class="recommendation-card">
                        <div class="rec-icon"><i class="fa-solid fa-glasses"></i></div>
                        <div>
                            <h4>UV Sunglasses</h4>
                            <p style="font-size: 0.8rem; color: var(--text-muted);">$29.99 - High UV Detected</p>
                        </div>
                    </div>
                </div>
                <a href="#" class="btn-buy">Visit Merch Store</a>
            </div>

            <!-- Flight Ticket Widget -->
            <div class="widget">
                <h3><i class="fa-solid fa-plane-departure"></i> Escape the Weather?</h3>
                <div class="recommendation-card" style="background: rgba(0, 210, 255, 0.1);">
                    <div class="rec-icon" style="background: var(--primary);"><i class="fa-solid fa-plane"></i></div>
                    <div>
                        <h4>Fly to Bali</h4>
                        <p style="font-size: 0.8rem; color: var(--text-muted);">Current: 30째C, Sunny</p>
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <label style="font-size: 0.8rem; color: var(--text-muted);">Quick Book</label>
                    <select style="width: 100%; padding: 0.5rem; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 5px; margin-top: 5px;">
                        <option>One Way</option>
                        <option>Round Trip</option>
                    </select>
                </div>
                <a href="#" class="btn-buy">Search Flights</a>
            </div>

            <div class="widget">
                <h3><i class="fa-solid fa-triangle-exclamation"></i> Alerts</h3>
                <p id="alertText" style="color: #ef4444;">No severe weather alerts at this location.</p>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2023-2024 Global OmniWeather Data Systems. All API data rights reserved.</p>
    </footer>

    <!-- External Script for Map -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // =========================================================
        // 1. API CONFIGURATION (THE PLACE TO UPDATE SOURCE)
        // =========================================================
        const API_CONFIG = {
            // Note: In a real app, never expose keys on client side. Use a proxy server.
            // For this demo, we will use a 'Mock Mode' if no key is provided.
            apiKey: "", // PUT YOUR OPENWEATHERMAP KEY HERE
            baseUrl: "https://api.openweathermap.org/data/2.5/weather",
            units: "metric"
        };

        // =========================================================
        // 2. INITIALIZATION & STATE
        // =========================================================
        let map;
        let chartInstance;

        document.addEventListener('DOMContentLoaded', () => {
            updateDate();
            initMap();
            initChart();
            // Load default city
            fetchWeather('London'); 
        });

        function updateDate() {
            const now = new Date();
            document.getElementById('currentDate').innerText = now.toUTCString().slice(0, 22);
        }

        // =========================================================
        // 3. CORE LOGIC & MOCK DATA GENERATOR
        // =========================================================
        
        async function fetchWeather(city = '') {
            const searchVal = city || document.getElementById('searchInput').value;
            if(!searchVal) return;

            // --- SIMULATION MODE (Because we don't have a live API Key in this demo) ---
            // If you add a key in API_CONFIG, replace this block with a real fetch()
            
            console.log(`Fetching data for ${searchVal}...`);
            
            // Simulating network delay
            document.getElementById('weatherDesc').innerText = "Analyzing Satellite Data...";
            
            setTimeout(() => {
                const mockData = generateMockData(searchVal);
                updateUI(mockData);
            }, 800);
        }

        function generateMockData(city) {
            // Random weather generator for demo purposes
            const conditions = ['Sunny', 'Rain', 'Cloudy', 'Storm', 'Snow'];
            const cond = conditions[Math.floor(Math.random() * conditions.length)];
            const temp = Math.floor(Math.random() * 35) - 5;
            
            return {
                name: city.charAt(0).toUpperCase() + city.slice(1),
                temp: temp,
                condition: cond,
                wind: Math.floor(Math.random() * 30),
                humidity: Math.floor(Math.random() * 100),
                pressure: 1000 + Math.floor(Math.random() * 50),
                visibility: Math.floor(Math.random() * 10) + 5,
                lat: 51.505 + (Math.random() - 0.5) * 10, // Random lat for demo map jump
                lon: -0.09 + (Math.random() - 0.5) * 10
            };
        }

        // =========================================================
        // 4. UI UPDATE ENGINE
        // =========================================================
        
        function updateUI(data) {
            // Update Text Info
            document.getElementById('cityName').innerText = data.name;
            document.getElementById('temperature').innerText = `${data.temp}째C`;
            document.getElementById('weatherDesc').innerText = data.condition;
            document.getElementById('updateTime').innerText = new Date().toLocaleTimeString();
            
            document.getElementById('windSpeed').innerText = `${data.wind} km/h`;
            document.getElementById('humidity').innerText = `${data.humidity}%`;
            document.getElementById('pressure').innerText = `${data.pressure} hPa`;
            document.getElementById('visibility').innerText = `${data.visibility} km`;

            // Update Map View
            if(map) {
                map.setView([data.lat, data.lon], 10);
                // Move marker (simplified for demo, usually we remove old layer)
            }

            // Update Dynamic Shop/Commercial Logic
            updateMerchandise(data.condition, data.temp);
            
            // Update Chart
            updateChartData();
        }

        function updateMerchandise(condition, temp) {
            const container = document.getElementById('merchContainer');
            let html = '';

            // Logic: IF Rain -> Sell Umbrella. IF Hot -> Sell Sunscreen.
            if(condition === 'Rain' || condition === 'Storm') {
                html += createProductCard('fa-umbrella', 'Storm Umbrella', '$15.00', 'High precip. detected');
                html += createProductCard('fa-shoe-prints', 'Waterproof Boots', '$45.00', 'Keep feet dry');
            } else if (temp > 25) {
                html += createProductCard('fa-glasses', 'UV Sunglasses', '$29.99', 'High UV Index');
                html += createProductCard('fa-bottle-water', 'Thermal Flask', '$12.50', 'Stay hydrated');
            } else if (temp < 10) {
                html += createProductCard('fa-mitten', 'Thermal Gloves', '$18.00', 'Freezing levels');
                html += createProductCard('fa-mug-hot', 'Portable Heater', '$35.00', 'Stay warm');
            } else {
                html += createProductCard('fa-camera', 'Travel Camera', '$199.00', 'Perfect weather for photos');
            }
            
            container.innerHTML = html;
        }

        function createProductCard(icon, title, price, reason) {
            return `
            <div class="recommendation-card">
                <div class="rec-icon"><i class="fa-solid ${icon}"></i></div>
                <div>
                    <h4>${title}</h4>
                    <p style="font-size: 0.8rem; color: var(--text-muted);">${price} - ${reason}</p>
                </div>
            </div>`;
        }

        // =========================================================
        // 5. MAP & CHART SETUP
        // =========================================================

        function initMap() {
            // Leaflet JS Open Source Map
            map = L.map('weatherMap').setView([51.505, -0.09], 13);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);

            // Add weather layer placeholder (Rain/Clouds)
            // Real apps use OWM Tile Layers here
        }

        function initChart() {
            const ctx = document.getElementById('tempChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                    datasets: [{
                        label: 'Temperature (째C)',
                        data: [12, 11, 14, 22, 21, 18],
                        borderColor: '#00d2ff',
                        backgroundColor: 'rgba(0, 210, 255, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false, color: '#334155' }, ticks: { color: '#94a3b8' } },
                        y: { grid: { color: '#334155' }, ticks: { color: '#94a3b8' } }
                    }
                }
            });
        }
        
        function updateChartData() {
            // Simulate changing forecast data
            const newData = Array.from({length: 6}, () => Math.floor(Math.random() * 30));
            chartInstance.data.datasets[0].data = newData;
            chartInstance.update();
        }

    </script>
</body>
</html>
